---
title: VIM编辑器大全(三)
sidebar: auto
date: '2019-07-25'
tag: # 页面的标签 
  - Linux
# 一些 meta 标签, 可以用于被搜索引擎爬取
head:
  - - meta
    - name: description
      content: Linux 常用命令 VIM编辑器 快捷键 笔记 基础  
    - name: keywords # keywords 标签, 在页内搜索时会被查询
      content: Linux 常用命令 VIM编辑器 快捷键 笔记 基础
prev: ./VIM编辑器配置(四)
next: ./ssh和root账户配置(二)
---

## VIM编辑器
vi编辑器是所有Unix及Linux系统下标准的编辑器，vim是vi的升级版。vi可以分为三种状态：命令模式（编辑模式）、插入模式（输入模式）和末行模式（扩展模式） 、可视模式（Visual） 
1. 命令模式（编辑模式）    
默认模式，可进行各种命令操作和移动，因为大部分操作是浏览而不是编辑，所以vim默认是命令模式（界面表现：左下角显示文件名或为空）

2. 插入模式（输入模式）  
只有在Insert mode下，才可以做文本编辑，修改文本（界面表现：左下角显示—INSERT–）插入模式下，按ESC按键返回命令模式

3. 末行模式（扩展模式）   
保存、退出等（界面表现：左下角显示—VISUAL–）末行模式下连续按两次ESC按键返回末行模式。  

不过一般我们在使用时把vim简化成两个模式，就是将末行模式（扩展模式）也算入命令模式（编辑模式）

4. 可视模式
Normal 模式下使用 `v` 进入visual 选择
使用 `V` 选择行
使用 `Ctrl + v` 进行方块选择

用vi进行编辑，保存操作：  
  - 进入文件： `vi /files/test.cfg`
  - 进入编辑状态按`i`或`a`,切换到输入状态，这个时候可以改变文件内容
  - 文件编辑完毕之后，需要退出编辑。退出编辑器又分为4种情况：保存退出、正常退出、不保存退出及强制退出
  - 按键盘左上角的`Esc`，左下角的插入状态不见了
  - 保存退出：输入`:wq`, w 即 write，写入（保存）, q 即 quit，退出；或者输入`x` 即 `x=wq`
  - 正常退出：正常退出有个前提条件是：打开的文本文件在内容上没有被改动过。按了`Esc`后,输入命令`:q`
  - 不保存退出： 按了`Esc`后,输入`:q!`
  - 强制退出: 输入命令`:!`

## 插入模式操作
``` 
ctrl + h 删除上一个字符，相当于回格键backspace
ctrl + w 删除上一个单词
ctrl + u 删除当前行

# 调整行缩进
ctrl + t 增加缩进
ctrl + d 减少缩进

# 上下行同列复制
ctrl + y 复制上一行的相同列的字符
ctrl + e 复制下一行的相同列的字符

ctrl + a 移动到开头
ctrl + e 移动到结尾
ctrl + b 往前移
ctrl + f 往后移
ctrl + j 向下新建一行

# 快速切换insert和normal模式，ESC的替代方案
使用 ctrl + c 代替 ESC（但是可能中断某些插件）或者 ctrl + [

# 从normal模式快速切换到insert模式
gi 快速跳转到最后一次编辑的地方并进入插入模式
```
<!-- ### 插入模式下的复制粘贴 -->
<!-- 一般会选择用鼠标选中，然后ctrl + v 粘贴

如果设置了 autoindent ，粘贴时代码缩进可能会错乱

这个时候需要使用 `:set paste` 和 `:set nopaste` 解决 -->


## 命令模式操作

### 退出
按ESC键 跳到命令模式，然后输入：

`:w        `- 保存文件，不退出 vim
`:w file`   - 将修改另外保存到 file 中，不退出 vim
`:w! `      - 强制保存，不退出 vim
`:wq       `- 保存文件，退出 vim
`:wq!`      - 强制保存文件，退出 vim
`:q        `- 不保存文件，退出 vim
`:q!`       - 不保存文件，强制退出 vim
`:e!`       - 放弃所有修改，从上次保存文件开始再编辑

### 进入插入模式
``` 
a (append)  当前字符的后面插入
i (insert) 当前字符的前面插入
o (open a line below) 向下新建一行插入

A (append after line)  在这一行的最后面插入
I (insert before line)  在这一行的最前面插入
O (append a line above)  向上新建一行插入
```

### 显示行号
``` 
:set nu
```

### 分屏
``` 
:vs (vertical split) 竖分屏
:sp (split) 横分屏
使用 `:q` 退出
```

### 移动
使用`hjkl`来移动，h（左）、j（下）、k（上）、l（右），移动也不会让手指脱离主键盘区

### 单词间移动，在单词间飞舞
``` 
w/W 移动到下一个 单词(word/WORD) 开头
e/E 移动到下一个 单词(word/WORD) 尾
b/B 移动到上一个 单词(word/WORD) 开头,可以理解成backword

# word 指的是以非空白符分割的单词，WORD 是以空白符分割的单词
```

### 行间搜索移动
同一行快速移动的方式其实是搜索一个字符并且移动到该字符，适用单个字符搜索

使用`f{char}` 可以到char字符上，`t` 移动到char的前一个字符

如果第一个次没搜索到，可以使用 逗号(,)、分号(;) 继续搜索这一行的 上一个、下一个

### vim水平移动
快速移动到一行的行首或行尾

`0` 快速移动到行首第一个字符，`^` 移动到第一个非空白字符

`$` 快速移动到行尾，`g_` 移动到行尾非空白字符

### 翻页/跳转指令
```
G 跳转至最后一行
  
gg 跳转至第一行  

H/M/L 跳转至屏幕的开头（Head），中间（Middle），结尾（Lower）

Home键 跳转至行首  

End键 跳转至行末  

ctrl + o 快速返回
```

### 选中
``` 
v 按字符选择, 经常使用的模式  

V 按行选择  

全选操作：
V + G
```

### 修改
常用的有三个，r(replace),c(change),s(substitute)

```
r 可以替换一个字符。

s 替换并进入插入模式

c 配合文本对象，可以快速进行文本修改，例如： caw，删除并进入插入模式
```

### 查找
使用 `/` 或 `?` 进行前向或者反向搜索

<!-- 使用 `N` 或 `n` 跳转上一个或下一个匹配 -->

<!-- 使用 `*` 或 `#` 进行当前单词的前向或者后向匹配 -->

<!-- :set incsearch -->

### 替换
语法： `:[range]s[ubstitute]/{pattern}/{string}/[flags]`,支持正则表达式

rang 表示范围 比如：`1,20` 表示1-20行，`%` 表示全部

pattern 是要替换的模式

string 是替换后的文本

flags表示替换的范围
- g(global) 表示全局范围内执行
- c(confirm) 表示确认，可以确认或者拒绝修改
- n(number) 报告匹配的此次而不替换，可以用来查询匹配的个数

例子：    
`:1,6 s/self/this/g`, 全局内执行将1-6行内的self替换成this

`:1,6 s/self//n`, 查询匹配self字符串的个数

### 复制
```
y (yank)复制选中的内容（经常使用的模式）  

yy 复制一行 (nyy：复制n行)  

yw/yiw 复制一个词，到空格结束 (nyw或者ynw，复制n个word，n为数字)  

y^ 复制当前到行头的内容；   

y$ 复制当前到行尾的内容；  

yG 复制至档尾（nyG或者ynG，复制到第n行，例如1yG或者y1G，复制到档尾）   
```

### 删除
```
x 小写的x表示向后删除一个字符,也就是删除光标所在字符  

X 大写的X表示删除光标前的一个字符,不包括光标所在字符

d 配合文本对象快速删除一个单词，例如 daw (d around word),删除一个单词

D 大写的D表示删除这一行的字符，不会删除换行符  

大小写d 和 x 都可以搭配数字来执行，表示多次执行命令。例如：10x表示删除包括光标在内的后面10个字符


d 搭配其他命令操作：

dd 删除一行  

dw  删除一个单词，执行的是daw

daw 删除一个单词并且包含周围的空格

diw 删除一个单词不删除空格

dt[txt] txt表示文本区域结束位置，例如：dt) 表示删除到)位置的内容，不包含) 

d$  删除到行尾

d0  删除到行首的内容
```

### 剪切
```
d   剪切选中的内容（经常使用的模式） 

dd  剪切一行(ndd：复制n行)  

ndd n表示数字，剪切光标所在的向下n行  

dw  剪切一个词，到空格结束 (ndw或者dnw，剪切n个word，n为数字)  

d^  剪切当前到行头的内容；   

d$  剪切当前到行尾的内容；       

d0  剪切光标所在到该行第一个字符  

dG  剪切至档尾（ndG或者ynG，剪切到第n行，例如1dG或者d1G，剪切到档尾）
```

::: tip Vim 寄存器
Vim 里操作的是寄存器而不是剪贴板

vim有12个寄存器，分别是0,1,2,...,9,a,`"`,＋; 在命令行模式下用 `:reg` 命令可以查看各个寄存器里的内容

vim中用 `y` 复制，只是简单的复制到 `"`寄存器中，用 `p` 粘贴也是粘贴这个寄存器中的内容

默认我们使用 `d`删除 `y`复制的内容都放到了 “无名寄存器中”

用 `x` 删除一个字符放到无名寄存器，然后 `p` 粘贴，可以调换两字符

通过 `"{register}` 前缀可以指定寄存器，不指定默认用无名寄存器，例如：`"ayiw` 复制一个单词到寄存器 a 中，`"bdd` 删除当前行到寄存器 b 中 
:::

### 粘贴
`p` (put)粘贴            //将光标移动到需要粘贴的地方按「 p 」即可  
shift+Insert: 从外面将将内容粘贴进vim中     //需要在编辑模式下进行操作

J: 将光标所在的行与下一行的数据合并为一行

### 撤销回退
u:撤销  
ctrl + r：回退撤销  

### 屏幕翻页 
```
ctrl+u 向上翻半屏   

ctrl+f 向上翻一屏   

ctrl+d 向下翻半屏   

ctrl＋b 向下翻一屏  

zz 把屏幕置为中间
```

## Buffer & Window & Tab
### Buffer 打开文件的内存缓冲区
  + Vim打开一个文件后会加载内容到缓冲区
  + 之后的修改都是针对内存中的缓冲区，并不会直接保存到文件
  + 执行:w(write) 的时候才会把缓冲区的内容写入到文件里

### 在Vim中，Buffer 之间的切换
- 使用:ls 会列出当前缓冲区
- `e [filename]` 打开文件，会新建缓冲区
- 使用:b n 跳转到第n个缓冲区
- :bpre :bnext :bfirst :blast
- 也可以使用:b buffer_name 加上tab补全来跳转

### Window 窗口是Buffer可视化的分割区域
当需要同时打开多个文件时可以采用

一个缓冲区可以分割成多个窗口，每个窗口也可以打开不同的缓冲区

`<ctrl + w>s` 水平分割，`<ctrl + w>v` 垂直分割；或者使用 `:sp` 和 `:vs`

### 切换窗口
```
<ctrl + w>w 在窗口间循环切换

<ctrl + w>h 切换到左边的窗口

<ctrl + w>j 切换到上边的窗口

<ctrl + w>k 切换到下边的窗口

<ctrl + w>l 切换到右边的窗口
```

> 移动窗口的位置
`<ctrl + w>L` 将左边窗口移动到右边
`<ctrl + w>H` 将右边窗口移动到左边

### Tab(标签页) 将窗口分组
Tab是可以容纳一系列窗口的容器（`:h tabpage`） 

可以把Vim的Tab想象成Linux的虚拟桌面

相比窗口，Tab一般用的比较少，Tab太多管理起来也比较麻烦

### Tab（标签页）操作
```
:tabe [dit] {filename} 在新标签页打开 filename

<ctrl + w>T 把当前窗口移动到新的标签页

:tabc [lose] 关闭当前标签页和其中所有窗口

:tabo [nly] 只保留活动标签页，关闭其他标签页

:tabp      前一个

:tabn      后一个

也可以使用：
gt , gT 可以直接在tab之间切换
```

## 批量操作，宏以及其他方式
宏可以看成是一系列命令的集合

我们用宏录制一系列操作，然后用于回放

### 宏 使用方式
Vim 使用 q{register} 来录制，使用 q 来结束

使用 q{register}选择要保存的寄存器，把录制的命令保存下来

使用 @{register} 回放寄存器中保存的一系列命令

批量操作：例如，给多行文本添加双引号，先录制 > 全选 > 回访
录制完之后，选中需要执行的文本，输入命令`:'<,'>normal @a`，给选中的文本都执行了宏操作

### 不使用宏实现批量操作
1. V + G 全选
2. 命令: `:'<,'>normal I"`
3. 命令: `:'<,'>normal A"`

全选之后通过在行首和行尾插入 `"` 也可以实现同样的效果

## Vim 在插入模式中补全
1. ctrl + n 和 ctrl + p 补全单词
```
ctrl + n 搜索文档中出现的单词，使用前缀匹配的方式补全
ctrl + p 
```

2. ctrl + x 和 ctrl + f 补全文件名 

在输入 / 之后，按快捷键 ctrl + x 和 ctrl + f 可以搜索相对文件路径

3. `:r! echo %` 插入当前的文件名

## Vim 切换主题色
使用`:colorscheme`显示当前主题配色

使用`:colorscheme <ctrl+d>` 可以显示所有的配色

用`:colorscheme [schemeName]` 可以修改配色

::: tip 同时打开多个文件，分屏显示
`vim test.js test2.js -O` 横向分屏，跟小写的 o 纵向
`vim test.js test2.js -p` 打开多个tab页
:::
